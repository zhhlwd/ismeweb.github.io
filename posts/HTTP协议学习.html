<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui"
    />
    <title>HTTP协议学习 | zhhlwd</title>
    <meta name="description" content="三人行，必有我师焉，择其善者而从之，其不善者而改之。" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="HTTP协议学习 | zhhlwd" />
    <meta property="og:site_name" content="HTTP协议学习 | zhhlwd" />
    <meta property="og:locale" content="zh-CN" />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="HTTP协议学习 | zhhlwd" />
    <link rel="shortcut icon" href="/favicon.ico">
    
    <link rel="preload" href="/assets/css/0.styles.068dd2cd.css" as="style"><link rel="preload" href="/assets/js/app.39e00e98.js" as="script"><link rel="preload" href="/assets/js/1.c0224360.js" as="script"><link rel="preload" href="/assets/js/15.f0ca96b2.js" as="script"><link rel="preload" href="/assets/js/5.b07737de.js" as="script"><link rel="preload" href="/assets/js/7.9893d61a.js" as="script"><link rel="preload" href="/assets/js/10.9c509957.js" as="script"><link rel="preload" href="/assets/js/6.57699fa9.js" as="script"><link rel="preload" href="/assets/js/26.16680b9b.js" as="script"><link rel="preload" href="/assets/js/14.0e97f0ce.js" as="script"><link rel="preload" href="/assets/js/16.9fb85302.js" as="script"><link rel="prefetch" href="/assets/js/11.4d3e3171.js"><link rel="prefetch" href="/assets/js/12.00842133.js"><link rel="prefetch" href="/assets/js/13.3ac04011.js"><link rel="prefetch" href="/assets/js/17.427877de.js"><link rel="prefetch" href="/assets/js/18.9fb398fc.js"><link rel="prefetch" href="/assets/js/19.feb0126e.js"><link rel="prefetch" href="/assets/js/20.13a93009.js"><link rel="prefetch" href="/assets/js/21.58f50a10.js"><link rel="prefetch" href="/assets/js/22.c63d4380.js"><link rel="prefetch" href="/assets/js/23.18289c78.js"><link rel="prefetch" href="/assets/js/24.c1a9de78.js"><link rel="prefetch" href="/assets/js/25.0bd81385.js"><link rel="prefetch" href="/assets/js/27.6cffb597.js"><link rel="prefetch" href="/assets/js/28.6322d617.js"><link rel="prefetch" href="/assets/js/29.988d048b.js"><link rel="prefetch" href="/assets/js/30.86340671.js"><link rel="prefetch" href="/assets/js/31.3920b019.js"><link rel="prefetch" href="/assets/js/32.043d59c3.js"><link rel="prefetch" href="/assets/js/33.179b9e0e.js"><link rel="prefetch" href="/assets/js/34.d62c08ea.js"><link rel="prefetch" href="/assets/js/35.5d1effb7.js"><link rel="prefetch" href="/assets/js/36.8f937390.js"><link rel="prefetch" href="/assets/js/37.d4c78315.js"><link rel="prefetch" href="/assets/js/38.6d9e9af7.js"><link rel="prefetch" href="/assets/js/39.c0d6b845.js"><link rel="prefetch" href="/assets/js/4.852cc3fd.js"><link rel="prefetch" href="/assets/js/40.0dd1da3d.js"><link rel="prefetch" href="/assets/js/41.a53d9e1e.js"><link rel="prefetch" href="/assets/js/42.ef67bdbc.js"><link rel="prefetch" href="/assets/js/43.8015aa78.js"><link rel="prefetch" href="/assets/js/44.3d19ff22.js"><link rel="prefetch" href="/assets/js/45.c4ec1046.js"><link rel="prefetch" href="/assets/js/46.b66c6c6a.js"><link rel="prefetch" href="/assets/js/47.792fbb9b.js"><link rel="prefetch" href="/assets/js/48.fff9e461.js"><link rel="prefetch" href="/assets/js/49.927540c7.js"><link rel="prefetch" href="/assets/js/50.7328b358.js"><link rel="prefetch" href="/assets/js/51.edf5a6f6.js"><link rel="prefetch" href="/assets/js/52.554531c8.js"><link rel="prefetch" href="/assets/js/53.cff155eb.js"><link rel="prefetch" href="/assets/js/54.79017acb.js"><link rel="prefetch" href="/assets/js/55.3f832b4e.js"><link rel="prefetch" href="/assets/js/56.fc46ef96.js"><link rel="prefetch" href="/assets/js/57.01d4bca6.js"><link rel="prefetch" href="/assets/js/58.af6eeeff.js"><link rel="prefetch" href="/assets/js/59.5f3be402.js"><link rel="prefetch" href="/assets/js/60.0babdfb8.js"><link rel="prefetch" href="/assets/js/61.acc49c38.js"><link rel="prefetch" href="/assets/js/62.3bbe5a99.js"><link rel="prefetch" href="/assets/js/63.4c1ad2b7.js"><link rel="prefetch" href="/assets/js/64.660d1af7.js"><link rel="prefetch" href="/assets/js/65.d8475e70.js"><link rel="prefetch" href="/assets/js/66.fe8f81dc.js"><link rel="prefetch" href="/assets/js/67.bc970a69.js"><link rel="prefetch" href="/assets/js/68.5b401715.js"><link rel="prefetch" href="/assets/js/69.60a017c7.js"><link rel="prefetch" href="/assets/js/70.d0fe42fc.js"><link rel="prefetch" href="/assets/js/71.34114315.js"><link rel="prefetch" href="/assets/js/72.962129e8.js"><link rel="prefetch" href="/assets/js/73.a2267a94.js"><link rel="prefetch" href="/assets/js/74.2401111b.js"><link rel="prefetch" href="/assets/js/75.361c8ec8.js"><link rel="prefetch" href="/assets/js/76.323e94c6.js"><link rel="prefetch" href="/assets/js/77.b3c2a687.js"><link rel="prefetch" href="/assets/js/8.001cad53.js"><link rel="prefetch" href="/assets/js/9.d5c24b06.js"><link rel="prefetch" href="/assets/js/search.de4016ee.js">
    <link rel="stylesheet" href="/assets/css/0.styles.068dd2cd.css">
  </head>
  <body>
    <div id="loader-wrapper" style="display: none;opacity:0">
      <div id="loader"></div>
      <div class="loader-section section-left"></div>
      <div class="loader-section section-right"></div>
    </div>
    <div id="app" data-server-rendered="true"><div style="height:100%;" data-v-3431ceb9><section class="el-container main-container" data-v-3431ceb9><aside class="el-aside menu" style="width:auto;" data-v-7a66351a data-v-3431ceb9><ul role="menubar" class="menu-wrap el-menu" style="background-color:;" data-v-7a66351a><li data-v-7a66351a><div class="brand-wrap" style="background-image:url(/brand.jpg);" data-v-7a66351a><div class="brand" data-v-7a66351a><a href="/" class="avatar waves-effect waves-circle waves-light router-link-active" data-v-7a66351a><img src="/avatar.jpg" data-v-7a66351a></a> <hgroup class="introduce" data-v-7a66351a><div class="nickname" data-v-7a66351a>zhhlwd</div> <a title="zhhlwd@qq.com" class="mail" data-v-7a66351a>zhhlwd@qq.com</a></hgroup></div></div></li> <li role="menuitem" tabindex="-1" class="el-menu-item" style="padding-left:20px;color:;background-color:;" data-v-7a66351a><i class="iconfont icon-home" data-v-7a66351a></i> <span class="item-title" data-v-7a66351a>主页</span></li> <li role="menuitem" tabindex="-1" class="el-menu-item" style="padding-left:20px;color:;background-color:;" data-v-7a66351a><i class="iconfont icon-biaoqian" data-v-7a66351a></i> <span class="item-title" data-v-7a66351a>标签分类</span></li> <li role="menuitem" tabindex="-1" class="el-menu-item" style="padding-left:20px;color:;background-color:;" data-v-7a66351a><i class="iconfont icon-wenzhang" data-v-7a66351a></i> <span class="item-title" data-v-7a66351a>时间归档</span></li> <li role="menuitem" tabindex="-1" class="el-menu-item" style="padding-left:20px;color:;background-color:;" data-v-7a66351a><i class="iconfont icon-github" data-v-7a66351a></i> <span class="item-title" data-v-7a66351a>Github</span></li> <li role="menuitem" tabindex="-1" class="el-menu-item" style="padding-left:20px;color:;background-color:;" data-v-7a66351a><i class="iconfont icon-aboutme" data-v-7a66351a></i> <span class="item-title" data-v-7a66351a>自我介绍</span></li></ul></aside> <section class="el-container container-warp" data-v-3431ceb9><header id="topHeader" class="el-header top-header" style="height:60px;padding-left:260px;" data-v-15c2c99c data-v-3431ceb9><div class="header-warp el-row is-align-middle el-row--flex" data-v-15c2c99c><div class="el-col el-col-12 el-col-xs-7" data-v-15c2c99c><div class="el-row is-align-middle el-row--flex" data-v-15c2c99c><div class="el-col el-col-2" data-v-15c2c99c><button type="button" class="el-button el-button--primary is-circle" data-v-15c2c99c><!----><!----><span><i class="iconfont icon-caidan" data-v-15c2c99c></i></span></button></div></div></div> <div class="el-col el-col-20 el-col-xs-24" data-v-15c2c99c><div class="grid-content bg-purple-light" data-v-15c2c99c><div class="el-row is-justify-end is-align-middle el-row--flex" data-v-15c2c99c><div class="el-col el-col-13 el-col-xs-24 el-col-sm-21 el-col-md-17 el-col-lg-13" data-v-15c2c99c><div aria-haspopup="listbox" role="combobox" aria-owns="el-autocomplete-3216" class="el-autocomplete search-input" data-v-15c2c99c><div class="el-input el-input--small el-input--suffix"><!----><input type="text" autocomplete="off" valueKey="value" popperClass="search-popper" placeholder="搜搜看" fetchSuggestions="function () { [native code] }" debounce="300" placement="bottom-start" popperAppendToBody="true" value="" class="el-input__inner"><!----><span class="el-input__suffix"><span class="el-input__suffix-inner"><i class="el-input__icon el-icon-search search-ico" data-v-15c2c99c></i><!----></span><!----></span><!----></div><div role="region" class="el-autocomplete-suggestion el-popper search-popper" style="width:;display:none;"><div class="el-scrollbar"><div class="el-autocomplete-suggestion__wrap el-scrollbar__wrap el-scrollbar__wrap--hidden-default"><ul class="el-scrollbar__view el-autocomplete-suggestion__list"></ul></div><div class="el-scrollbar__bar is-horizontal"><div class="el-scrollbar__thumb" style="width:0;transform:translateX(0%);ms-transform:translateX(0%);webkit-transform:translateX(0%);"></div></div><div class="el-scrollbar__bar is-vertical"><div class="el-scrollbar__thumb" style="height:0;transform:translateY(0%);ms-transform:translateY(0%);webkit-transform:translateY(0%);"></div></div></div></div></div></div></div></div></div></div></header> <main class="el-main my-main" style="margin-left:240px;" data-v-c4863568 data-v-3431ceb9><div class="content-header index-header" data-v-61dd99b6 data-v-c4863568><div class="container fade-scale in" data-v-61dd99b6><h1 id="conentHeader" class="title" data-v-61dd99b6>HTTP协议学习</h1> <h5 class="subtitle" data-v-61dd99b6>最后更新时间：2019-02-23 00:09:45</h5></div></div> <div data-v-aa2eb952 data-v-c4863568 data-v-c4863568><div class="post-content el-row is-justify-center el-row--flex" data-v-aa2eb952><div id="post-card" class="post-card post-sign el-col el-col-16 el-col-xs-24 el-col-sm-23 el-col-md-23 el-col-lg-16" data-v-aa2eb952><div class="content__default" data-v-aa2eb952><p>HTTP 的知识新手也许感觉没什么重要的,但是随着学习的加深,它就会变得越来越重要,限制人的技术的高度和深度,例如一个 HTTP 请求失败的分析,和后端讨论方案等等,都会让你畏手畏脚,底气不足.</p> <h2 id="五层网络模型"><a href="#五层网络模型" aria-hidden="true" class="header-anchor">#</a> 五层网络模型</h2> <p><img src="https://s1.ax1x.com/2018/12/31/F4UWo6.md.png" alt="五层网络模型"></p> <p>我们一般在讲解网络信息传输的时候,都会套用一个五层模型来诠释.在每台电脑,每台服务器上都可以用它来维护我们的网络传输.</p> <h3 id="低三层"><a href="#低三层" aria-hidden="true" class="header-anchor">#</a> 低三层</h3> <p>比较底层,靠近硬件,我们不用过于关心了解</p> <h4 id="物理层"><a href="#物理层" aria-hidden="true" class="header-anchor">#</a> 物理层</h4> <p>主要作用是定义物理设备如何传输数据;<br>
简单来说就是我们电脑的硬件,网卡,光缆</p> <h4 id="数据链路层"><a href="#数据链路层" aria-hidden="true" class="header-anchor">#</a> 数据链路层</h4> <p>在通信的实体间建立数据链路连接;<br>
就是帮我们在硬件之间创建连接的比较底层的软件服务,最基础的 0101 的二进制传播</p> <h4 id="网络层"><a href="#网络层" aria-hidden="true" class="header-anchor">#</a> 网络层</h4> <p>为数据在结点之间传输创建逻辑链路;<br>
就是比如我们的电脑如何寻找百度的服务器,和它建立连接</p> <h3 id="传输层"><a href="#传输层" aria-hidden="true" class="header-anchor">#</a> 传输层</h3> <p>主要有两个协议 tcp 和 udp.一般我们用 tcp 协议的比较多,因为它更加安全稳定</p> <p>传输层向用户提供可靠的端到端(End-to-End)服务,就是我们的电脑和百度的服务器建立了连接后,我们之间如何去传输数据,我们传输的数据可能很小可能很大,我们要分包分片,传输过去后要进行数据的组装等等这些都是在传输层定义的.</p> <p>传输层向高层屏蔽了下层数据通信的细节,我们输入一个 url,创建一个 ajax 等等,都是其中网络如何分包组装,如何保证数据的完整性等等这些都是 http 不用关心的事</p> <h3 id="应用层"><a href="#应用层" aria-hidden="true" class="header-anchor">#</a> 应用层</h3> <p>http 协议就在这一层</p> <p>为应用软件提供了很多服务</p> <p>构建于 TCP 协议之上</p> <p>屏蔽网络传输相关细节</p> <h2 id="http-协议历史"><a href="#http-协议历史" aria-hidden="true" class="header-anchor">#</a> HTTP 协议历史</h2> <h3 id="http-0-9"><a href="#http-0-9" aria-hidden="true" class="header-anchor">#</a> HTTP/0.9</h3> <p>比较简单,只有一个命令 GET</p> <p>没有 header 等描述数据的信息</p> <p>服务器发送完毕, 就关闭 TCP 连接</p> <h3 id="http-1-0"><a href="#http-1-0" aria-hidden="true" class="header-anchor">#</a> HTTP/1.0</h3> <p>增加了很多命令 如 POST ,HEAD , PUT</p> <p>增加了 status code 和 header</p> <p>多字符集支持、多部分发送、权限、缓存等</p> <h3 id="http-1-1"><a href="#http-1-1" aria-hidden="true" class="header-anchor">#</a> HTTP/1.1</h3> <p>持久连接,http 请求后 tcp 连接可以不立即关闭</p> <p>pipeline,就是 http 请求的在服务端在以前前一个请求处理时间比较久,后一个比较快,都是服务端处理是按顺序的,问题就像 JavaScript 的事件的并行和串行,所以在 http1.1 做了优化</p> <p>增加 host 和其他一些命令(一台物理服务器可以开多个 web 服务)</p> <h3 id="http2"><a href="#http2" aria-hidden="true" class="header-anchor">#</a> HTTP2</h3> <p>所有数据以二进制传输,在 http1.1 里.大部分的数据是字符串格式的</p> <p>同一个连接里面发送多个请求不再需要按照顺序来(并行的效率)</p> <p>头信息压缩以及推送等提高效率的功能,不必要的头信息会省略,还有服务器可以主动发起一些数据传输的,比如可以在请求 HTML 文档的时候主动把相关的图片,js 和 css 推送到客户端</p> <h2 id="tcp-三次握手"><a href="#tcp-三次握手" aria-hidden="true" class="header-anchor">#</a> TCP 三次握手</h2> <p><img src="https://s1.ax1x.com/2018/12/31/F40mp8.md.png" alt="F40mp8.md.png">
http 协议不存在连接的概念,只有请求和响应的概念,它是进行在一个 TCP connection 中, tcp 连接可以发送多个 http 请求.
<img src="https://s1.ax1x.com/2018/12/31/F4wOT1.png" alt="F4wOT1.png"> <img src="https://s1.ax1x.com/2018/12/31/F4017n.md.png" alt="F4017n.md.png">
第一次握手<br>
建立连接。客户端发送连接请求报文段，将 SYN 位置为 1，Sequence Number 为 x；然后，客户端进入 SYN_SEND 状态，等待服务器的确认；</p> <p>第二次握手<br>
服务器收到 SYN 报文段。服务器收到客户端的 SYN 报文段，需要对这个 SYN 报文段进行确认，设置 Acknowledgment Number 为 x+1(Sequence Number+1)；同时，自己自己还要发送 SYN 请求信息，将 SYN 位置为 1，Sequence Number 为 y；服务器端将上述所有信息放到一个报文段（即 SYN+ACK 报文段）中，一并发送给客户端，此时服务器进入 SYN_RECV 状态；</p> <p>第三次握手<br>
客户端收到服务器的 SYN+ACK 报文段。然后将 Acknowledgment Number 设置为 y+1，向服务器发送 ACK 报文段，这个报文段发送完毕以后，客户端和服务器端都进入 ESTABLISHED 状态，完成 TCP 三次握手。</p> <h3 id="为什么要三次握手"><a href="#为什么要三次握手" aria-hidden="true" class="header-anchor">#</a> 为什么要三次握手</h3> <p>为了防止已失效的连接请求报文段突然又传送到了服务端，因而让服务端创建无用的连接。</p> <p>具体例子：“已失效的连接请求报文段”的产生在这样一种情况下：client 发出的第一个连接请求报文段并没有丢失，而是在某个网络结点长时间的滞留了，以致延误到连接释放以后的某个时间才到达 server。本来这是一个早已失效的报文段。但 server 收到此失效的连接请求报文段后，就误认为是 client 再次发出的一个新的连接请求。于是就向 client 发出确认报文段，同意建立连接。假设不采用“三次握手”，那么只要 server 发出确认，新的连接就建立了。由于现在 client 并没有发出建立连接的请求，因此不会理睬 server 的确认，也不会向 server 发送数据。但 server 却以为新的运输连接已经建立，并一直等待 client 发来数据。这样，server 的很多资源就白白浪费掉了。采用“三次握手”的办法可以防止上述现象发生。例如刚才那种情况，client 不会向 server 的确认发出确认。server 由于收不到确认，就知道 client 并没有要求建立连接。</p> <h2 id="tcp-四次挥手"><a href="#tcp-四次挥手" aria-hidden="true" class="header-anchor">#</a> TCP 四次挥手</h2> <p><img src="https://s1.ax1x.com/2018/12/31/F4BEDJ.md.png" alt="F4BEDJ.md.png">
第一次分手<br>
主机 1（可以使客户端，也可以是服务器端），设置 Sequence Number，向主机 2 发送一个 FIN 报文段；此时，主机 1 进入 FIN_WAIT_1 状态；这表示主机 1 没有数据要发送给主机 2 了；</p> <p>第二次分手<br>
主机 2 收到了主机 1 发送的 FIN 报文段，向主机 1 回一个 ACK 报文段，Acknowledgment Number 为 Sequence Number 加 1；主机 1 进入 FIN_WAIT_2 状态；主机 2 告诉主机 1，我“同意”你的关闭请求；</p> <p>第三次分手<br>
主机 2 向主机 1 发送 FIN 报文段，请求关闭连接，同时主机 2 进入 LAST_ACK 状态；</p> <p>第四次分手<br>
主机 1 收到主机 2 发送的 FIN 报文段，向主机 2 发送 ACK 报文段，然后主机 1 进入 TIME_WAIT 状态；主机 2 收到主机 1 的 ACK 报文段以后，就关闭连接；此时，主机 1 等待 2MSL 后依然没有收到回复，则证明 Server 端已正常关闭，那好，主机 1 也可以关闭连接了。</p> <h3 id="为什么要四次分手"><a href="#为什么要四次分手" aria-hidden="true" class="header-anchor">#</a> 为什么要四次分手</h3> <p>TCP 协议是一种面向连接的、可靠的、基于字节流的运输层通信协议。TCP 是全双工模式，这就意味着，当主机 1 发出 FIN 报文段时，只是表示主机 1 已经没有数据要发送了，主机 1 告诉主机 2，它的数据已经全部发送完毕了；但是，这个时候主机 1 还是可以接受来自主机 2 的数据；当主机 2 返回 ACK 报文段时，表示它已经知道主机 1 没有数据发送了，但是主机 2 还是可以发送数据到主机 1 的；当主机 2 也发送了 FIN 报文段时，这个时候就表示主机 2 也没有数据要发送了，就会告诉主机 1，我也没有数据要发送了，之后彼此就会愉快的中断这次 TCP 连接。</p> <h2 id="uri、url、urn"><a href="#uri、url、urn" aria-hidden="true" class="header-anchor">#</a> URI、URL、URN</h2> <h3 id="uri"><a href="#uri" aria-hidden="true" class="header-anchor">#</a> URI</h3> <p>URI 包含 URL 和 URN</p> <p>Uniform Resource Identifier / 统一资源标识符</p> <p>用来唯一标识互联网上的信息资源</p> <h3 id="url"><a href="#url" aria-hidden="true" class="header-anchor">#</a> URL</h3> <p>Uniform Resource Locator / 统一资源定位器</p> <p>http://user:pass@host.com:80/path?query=string#hash</p> <p>协议: http://</p> <p>身份(现在基本不用): user:pass@</p> <p>服务器地址: host.com (本质用的是 ip)</p> <p>端口: :80 (默认是 80, 所以地址栏一般都是看不到)</p> <p>路由: /path</p> <p>搜索参数: ?query=string</p> <p>文档的不同 hash: #hash</p> <h3 id="urn"><a href="#urn" aria-hidden="true" class="header-anchor">#</a> URN</h3> <p>永久统一资源定位符</p> <p>在资源移动之后还能被找到</p> <p>目前还没有非常成熟的使用方案</p> <h2 id="http-报文"><a href="#http-报文" aria-hidden="true" class="header-anchor">#</a> HTTP 报文</h2> <p><img src="https://s1.ax1x.com/2018/12/31/F4BtUI.md.png" alt="F4BtUI.md.png"></p> <h3 id="http-请求报文"><a href="#http-请求报文" aria-hidden="true" class="header-anchor">#</a> http 请求报文</h3> <p>http 请求报文是指客户端到服务器端的消息，客户端通过发送 http 请求向服务器请求对资源的访问。包括三个部分：请求行、请求头部、请求数据。请求方法有 OPTIONS、GET、HEAD、POST、PUT、DELETE、TRACE、CONNECT 这几种。</p> <ol><li>请求行：包含请求方法、uri 和协议的版本，用空格分隔，例如：GET/sample.jsp HTTP/1.1</li> <li>请求头部：包含有关客户端环境及请求正文的信息，如请求正文长度、浏览器所用编码格式等，例如;</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>Accept:image/gif.image/jpeg.*/*

Accept-Language:zh-cn

Connection:Keep-Alive

Host:localhost

User-Agent:Mozila/4.0(compatible:MSIE5.01:Windows NT5.0)

Accept-Encoding:gzip,deflate
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><ol start="3"><li>请求数据：即客户端发送给服务器的内容，可为空（GET 请求就没有请求数据），例如：username=jinqiao&amp;password=1234, 请求头部和请求数据之间必须有空行，用以区分。</li></ol> <h3 id="http-响应报文"><a href="#http-响应报文" aria-hidden="true" class="header-anchor">#</a> HTTP 响应报文</h3> <p>http 应答报文是指服务器回应 http 请求，发送给客户端的消息。也包括三个部分：状态行、响应头部、响应数据。</p> <ol><li>状态行：协议版本、状态码、简要描述，例如：HTTP/1.1 200 OK</li> <li>响应头部：必须指明 Content-Type，其他可选，例如：Content-Type: text/plain</li> <li>响应数据：即服务器回应客户端的内容。</li></ol> <p>常见状态码</p> <ul><li>1xx：指示信息--表示请求已接收，继续处理。</li> <li>2xx：成功--表示请求已被成功接收、理解、接受。</li> <li>3xx：重定向--要完成请求必须进行更进一步的操作。</li> <li>4xx：客户端错误--请求有语法错误或请求无法实现。</li> <li>5xx：服务器端错误--服务器未能实现合法的请求。</li></ul> <h2 id="cors-跨域请求的限制与解决"><a href="#cors-跨域请求的限制与解决" aria-hidden="true" class="header-anchor">#</a> CORS 跨域请求的限制与解决</h2> <p>不管有没有跨域, 客户端发起请求, 服务端都会接受你的请求并且返回内容.</p> <p>跨域是浏览器来做的! 浏览器接受到服务器返回的内容, 没看到请求头中没有设置 Access-Control-Allow-Origin 就报错, 不展示给你结果!</p> <p>一句话: 服务端没有跨域, 只有浏览器有同源策略</p> <h3 id="解决跨域"><a href="#解决跨域" aria-hidden="true" class="header-anchor">#</a> 解决跨域</h3> <h4 id="cors"><a href="#cors" aria-hidden="true" class="header-anchor">#</a> CORS</h4> <p>增加 Access-Control-Allow-Origin 响应头</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>response<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token string">'Access-Control-Allow-Origin'</span><span class="token punctuation">:</span> <span class="token string">'*'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="jsonp-处理跨域"><a href="#jsonp-处理跨域" aria-hidden="true" class="header-anchor">#</a> JSONP 处理跨域</h4> <p>利用 img script link 三个标签可以发起跨域请求.</p> <h3 id="cors-预请求"><a href="#cors-预请求" aria-hidden="true" class="header-anchor">#</a> CORS 预请求</h3> <p>其他不被允许的都要经过预请求
跨域时, 允许的方法只有 GET HEAD POST.</p> <p>跨域时, 允许的 Content-Type 有 text/plain multipart/form-data application/x-www-form-urlencoded</p> <p>其他限制:</p> <p>请求头限制</p> <p>XMLHttpRequestUpload 对象均没有注册任何事件监听器</p> <p>请求中没有使用 ReadableStream 对象</p> <h3 id="增加-access-control-allow-headers-x-test-cors"><a href="#增加-access-control-allow-headers-x-test-cors" aria-hidden="true" class="header-anchor">#</a> 增加 'Access-Control-Allow-Headers': 'X-Test-Cors'</h3> <p>浏览器对跨域请求的预请求</p> <p>会先发送一个 OPTIONS 请求, 服务端根据不同的 methods 进行不同的操作.</p> <p>利用 OPSTIONS 请求获得服务端认可, 实际发送 POST 请求
<img src="https://s1.ax1x.com/2018/12/31/F4r96U.md.png" alt="F4r96U.md.png"></p> <h4 id="设置-methods"><a href="#设置-methods" aria-hidden="true" class="header-anchor">#</a> 设置 Methods</h4> <p><img src="https://s1.ax1x.com/2018/12/31/F4rim4.md.png" alt="F4rim4.md.png"></p> <h3 id="设置-max-age"><a href="#设置-max-age" aria-hidden="true" class="header-anchor">#</a> 设置 Max-Age</h3> <p>'Access-Control-Max-Age': '1000', 表示 1000 s 不需要再发预请求.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

http
  <span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span> response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'request come'</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
    response<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token string">'Access-Control-Allow-Origin'</span><span class="token punctuation">:</span> <span class="token string">'*'</span><span class="token punctuation">,</span>
      <span class="token string">'Access-Control-Allow-Headers'</span><span class="token punctuation">:</span> <span class="token string">'X-Test-Cors'</span><span class="token punctuation">,</span>
      <span class="token string">'Access-Control-Allow-Methods'</span><span class="token punctuation">:</span> <span class="token string">'POST, PUT, DELETE'</span><span class="token punctuation">,</span>
      <span class="token string">'Access-Control-Max-Age'</span><span class="token punctuation">:</span> <span class="token string">'1000'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    response<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'123'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8887</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'server run 8887'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h2 id="cache-control"><a href="#cache-control" aria-hidden="true" class="header-anchor">#</a> Cache-Control</h2> <p><img src="https://s1.ax1x.com/2018/12/31/F4rQne.md.png" alt="F4rQne.md.png"></p> <h3 id="可缓存性"><a href="#可缓存性" aria-hidden="true" class="header-anchor">#</a> 可缓存性</h3> <p>public, 表示所有 http 经过的任何地方(代理)都可以缓存</p> <p>private, 只有发起请求的浏览器才可以缓存</p> <p>no-cache, 告诉浏览器、缓存服务器，不管本地副本是否过期，使用资源副本前，一定要到源服务器进行副本有效性校验</p> <p>no-cache 从字面意义上很容易误解为不缓存，但是 no-cache 代表不缓存过期的资源，缓存会向服务器进行有效处理确认之后处理资源</p> <h3 id="到期"><a href="#到期" aria-hidden="true" class="header-anchor">#</a> 到期</h3> <p>max-age=&lt; seconds &gt;, 缓存到多少秒过期</p> <p>s-maxage=&lt; seconds &gt;, 会代替 max-age, 只有在代理服务器才会生效, 浏览器还是会读取 max-age</p> <p>max-stale=&lt; seconds &gt;, 发起请求方主动带的头信息, 代表即便缓存已经过期, 在 max-stale 设置的时间内还是会读取缓存, 浏览器用不到.</p> <h3 id="重新验证"><a href="#重新验证" aria-hidden="true" class="header-anchor">#</a> 重新验证</h3> <p>must-revalidate, 设置了 max-age 并且已经过期了, 那么会重新发起请求到原服务端获取数据看是否真的过期, 而不是直接使用缓存</p> <p>proxy-revalidate,同 must-revalidate 只不过用在代理服务器上.</p> <h3 id="其他"><a href="#其他" aria-hidden="true" class="header-anchor">#</a> 其他</h3> <p>no-store, 永远都要去服务器拿新的内容,no-store 才是真正的不进行缓存.</p> <p>no-transform, 用于缓存服务器中,告诉代理服务器不要随意改动内容</p> <p>前端最常见的是更新文件时按文件内容设置 hash 类似 72.63f2ae81.js, 这样如果文件内容改变, hash 就变化了, 浏览器就会拿到新的文件.</p> <h2 id="last-modified-和-etag"><a href="#last-modified-和-etag" aria-hidden="true" class="header-anchor">#</a> Last-Modified 和 Etag</h2> <h3 id="验证头"><a href="#验证头" aria-hidden="true" class="header-anchor">#</a> 验证头</h3> <ul><li>Last-Modified</li> <li>Etag</li></ul> <h3 id="last-modified"><a href="#last-modified" aria-hidden="true" class="header-anchor">#</a> Last-Modified</h3> <p>根据上次修改时间</p> <p>配合 If-Modified-Since 或者 If-Unmodified-Since 使用</p> <p>也就是浏览器下次发起请求会带上 If-Modified-Since 头信息, 值就是 服务器返回 Last-Modified 的值.</p> <p>对比上次修改时间以验证资源是否需要更新</p> <h3 id="etag"><a href="#etag" aria-hidden="true" class="header-anchor">#</a> Etag</h3> <p>根据数据签名 (常用的是 hash 计算)</p> <p>配合 If-match 或者 If-Non-Match 使用</p> <p>也就是浏览器下次发起请求会带上 If-match 或者 If-Non-Match 头信息, 值就是服务器返回的 Etag 的值.</p> <p>对比资源的签名判断是否使用缓存</p> <h3 id="设置"><a href="#设置" aria-hidden="true" class="header-anchor">#</a> 设置</h3> <p>设置从缓存读取的话就不重新发送内容
<img src="https://s1.ax1x.com/2018/12/31/F4smUs.md.png" alt="F4smUs.md.png"></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span>url <span class="token operator">===</span> <span class="token string">'/script.js'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> etag <span class="token operator">=</span> request<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">'if-none-match'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>etag <span class="token operator">===</span> <span class="token string">'777'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    response<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">304</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token string">'Content-Type'</span><span class="token punctuation">:</span> <span class="token string">'text/javascript'</span><span class="token punctuation">,</span>
      <span class="token string">'Cache-Control'</span><span class="token punctuation">:</span> <span class="token string">'max-age=2000000, no-cache'</span><span class="token punctuation">,</span>
      <span class="token string">'Last-Modified'</span><span class="token punctuation">:</span> <span class="token string">'123'</span><span class="token punctuation">,</span>
      Etag<span class="token punctuation">:</span> <span class="token string">'777'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    response<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    response<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token string">'Content-Type'</span><span class="token punctuation">:</span> <span class="token string">'text/javascript'</span><span class="token punctuation">,</span>
      <span class="token string">'Cache-Control'</span><span class="token punctuation">:</span> <span class="token string">'max-age=2000000, no-cache'</span><span class="token punctuation">,</span>
      <span class="token string">'Last-Modified'</span><span class="token punctuation">:</span> <span class="token string">'123'</span><span class="token punctuation">,</span>
      Etag<span class="token punctuation">:</span> <span class="token string">'777'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    response<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'console.log(&quot;script loaded&quot;)'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h2 id="cookie-和-session"><a href="#cookie-和-session" aria-hidden="true" class="header-anchor">#</a> cookie 和 session</h2> <h3 id="cookie"><a href="#cookie" aria-hidden="true" class="header-anchor">#</a> cookie</h3> <p>服务器通过 Set-Cookie 这个 header 设置到浏览器里面, 保存在浏览器</p> <p>下次同域的请求中就会带上这个 cookie</p> <p>键值对, 可以设置多个</p> <h3 id="cookie-属性"><a href="#cookie-属性" aria-hidden="true" class="header-anchor">#</a> cookie 属性</h3> <p>max-age 和 expires 设置过期时间</p> <p>secure 只在 https 的时候发送</p> <p>设置 http-only 后, 无法通过 document.cookie 访问</p> <h3 id="设置过期时间"><a href="#设置过期时间" aria-hidden="true" class="header-anchor">#</a> 设置过期时间</h3> <p>'Set-Cookie': ['id=123;max-age=2']</p> <h3 id="cookie-domain"><a href="#cookie-domain" aria-hidden="true" class="header-anchor">#</a> cookie domain</h3> <p>设置 domain 可以让 test.a.com 访问到 a.com 的 cookie.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
http
  <span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span> response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'request come'</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> host <span class="token operator">=</span> request<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>host<span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span>url <span class="token operator">===</span> <span class="token string">'/'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> html <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">'test.html'</span><span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span>host <span class="token operator">===</span> <span class="token string">'test.com'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        response<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
          <span class="token string">'Content-Type'</span><span class="token punctuation">:</span> <span class="token string">'text/html'</span><span class="token punctuation">,</span>
          <span class="token string">'Set-Cookie'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'id=123;max-age=2;domain=test.com'</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      response<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8888</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'server run 8888'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h3 id="session"><a href="#session" aria-hidden="true" class="header-anchor">#</a> session</h3> <p>session 有很多种实现方式, 经常用的是 cookie 而已.</p> <p>比如服务器可以根据 cookie 里面的一个唯一 key 然后去查用户信息, 只要能定位用户, 就是 session.</p> <p>不一定要 cookie, 也可以 js 写在 header 中.</p> <h2 id="http-长连接"><a href="#http-长连接" aria-hidden="true" class="header-anchor">#</a> HTTP 长连接</h2> <p>在一个 tcp 连接发 多个 http 请求.</p> <p>长连接会复用 tcp 连接, chrome 并发是 6 个.</p> <p>Connection: keep-alive 表示长连接开启.</p> <p>'Connection': 'close' 关闭常长连接:</p> <h2 id="数据协商"><a href="#数据协商" aria-hidden="true" class="header-anchor">#</a> 数据协商</h2> <p>客户端给服务端发送请求的时候, 客户端会在请求头中声明我希望拿到的数据格式及数据相关的限制是怎样的,</p> <p>服务端会根据客户端请求, 做出判断, 再具体返回什么.</p> <h3 id="分类"><a href="#分类" aria-hidden="true" class="header-anchor">#</a> 分类</h3> <p>请求 和 返回</p> <h3 id="请求"><a href="#请求" aria-hidden="true" class="header-anchor">#</a> 请求</h3> <h4 id="accept"><a href="#accept" aria-hidden="true" class="header-anchor">#</a> Accept</h4> <p>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,<em>/</em>;q=0.8</p> <p>指定想要的数据类型(根据 MIME 类型告诉服务端想要什么)</p> <h4 id="accept-encoding"><a href="#accept-encoding" aria-hidden="true" class="header-anchor">#</a> Accept-Encoding</h4> <p>Accept-Encoding: gzip, deflate, br</p> <p>数据的编码方式, 主要是告诉服务端怎样的一个数据压缩(数据压缩算法有很多 gzip, deflate, br 等)</p> <h4 id="accept-language"><a href="#accept-language" aria-hidden="true" class="header-anchor">#</a> Accept-Language</h4> <p>Accept-Language: zh-CN,zh;q=0.9,en;q=0.8</p> <p>语言, 比如中文, q 表示权重</p> <h4 id="user-agent"><a href="#user-agent" aria-hidden="true" class="header-anchor">#</a> User-Agent</h4> <p>User-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/69.0.3497.92 Safari/537.36</p> <p>Mozilla/5.0 网景浏览器的头</p> <p>Windows NT 10.0; WOW64 操作系统版本</p> <p>AppleWebKit/537.36 表示 苹果公司开发的 WebKit 内核</p> <p>KHTML 类似 火狐的 Gecko 的渲染引擎</p> <p>Chrome/69.0.3497.92 浏览器版本号</p> <p>Safari/537.36 因为是苹果的 webkit 内核, 所以会加上这个</p> <p>浏览器相关的信息, 移动端还是 PC.</p> <h3 id="返回"><a href="#返回" aria-hidden="true" class="header-anchor">#</a> 返回</h3> <h4 id="content-type"><a href="#content-type" aria-hidden="true" class="header-anchor">#</a> Content-Type</h4> <p>对应请求中的 Accept, Accept 可以有很多种类型, Content-Type 可以从里面选择一种返回</p> <p>可以设置 X-Content-Type-Options: nosniff, 禁止浏览器根据内容去预测类型, 为了安全性.</p> <h4 id="content-encoding"><a href="#content-encoding" aria-hidden="true" class="header-anchor">#</a> Content-Encoding</h4> <p>对应 Accept-Language</p> <h4 id="content-language"><a href="#content-language" aria-hidden="true" class="header-anchor">#</a> Content-Language</h4> <p>对应 Accept-Language</p> <h4 id="服务端不返回-user-agent"><a href="#服务端不返回-user-agent" aria-hidden="true" class="header-anchor">#</a> 服务端不返回 User-Agent</h4> <p>数据在整个传输过程中大小: 包含 http headers 和 body 和首行信息</p> <p>数据拿到后并且根据 Content-Encoding 解压后的 body 实际内容大小, 不是 传输里面的 body 大小</p> <h3 id="mime-类型"><a href="#mime-类型" aria-hidden="true" class="header-anchor">#</a> MIME 类型</h3> <p>application/x-www-form-urlencoded</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span>
  <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>/form<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">enctype</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>application/x-www-form-urlencoded
<span class="token punctuation">&quot;</span></span>
<span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>name <span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>password<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>password <span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>submit <span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>请求头:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Content-Type: application/x-www-form-urlencoded

name=1&amp;password=1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>multipart/form-data</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>/form<span class="token punctuation">&quot;</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span> <span class="token attr-name">enctype</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>multipart/form-data <span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>password<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>password<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>请求头:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryIyBOcYI2n3gyM9IQ

// ----WebKitFormBoundaryIyBOcYI2n3gyM9IQ 用来分隔表单每一项
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>------WebKitFormBoundaryIyBOcYI2n3gyM9IQ
Content-Disposition: form-data; name=&quot;name&quot;

3
------WebKitFormBoundaryIyBOcYI2n3gyM9IQ
Content-Disposition: form-data; name=&quot;password&quot;

4
------WebKitFormBoundaryIyBOcYI2n3gyM9IQ
Content-Disposition: form-data; name=&quot;file&quot;; filename=&quot;url-tcp.png&quot;
Content-Type: image/png

------WebKitFormBoundaryIyBOcYI2n3gyM9IQ--
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h2 id="redirect"><a href="#redirect" aria-hidden="true" class="header-anchor">#</a> Redirect</h2> <p>服务器告诉浏览器你要的资源在什么地方, 浏览器重新请求新的地址</p> <h3 id="_302-临时跳转"><a href="#_302-临时跳转" aria-hidden="true" class="header-anchor">#</a> 302 临时跳转</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

http
  <span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span> response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'request come'</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span>url <span class="token operator">===</span> <span class="token string">'/'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      response<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">302</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        Location<span class="token punctuation">:</span> <span class="token string">'/new'</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      response<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span>url <span class="token operator">===</span> <span class="token string">'/new'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      response<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token string">'Content-Type'</span><span class="token punctuation">:</span> <span class="token string">'text/html'</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      response<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'&lt; div &gt;this is conetnt&lt; div &gt;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8888</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'server run 8888'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h3 id="_301-永远跳转"><a href="#_301-永远跳转" aria-hidden="true" class="header-anchor">#</a> 301 永远跳转</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code>response<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">301</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  Location<span class="token punctuation">:</span> <span class="token string">'/new'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>只有第一次是 301, 以后每次否是请求最新的了. 直接在浏览器变成新的路径, 不需要再去服务器指定新的 location.</p> <p>from disk 已经存到浏览器了.注意: 301 不会主动失效, 只有当用户清除缓存才行.</p> <h2 id="content-security-policy"><a href="#content-security-policy" aria-hidden="true" class="header-anchor">#</a> Content-Security-Policy</h2> <p><a href="https://developer.mozilla.org/zh-CN/docs/Glossary/CSP" target="_blank" rel="noopener noreferrer">内容安全策略<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="作用"><a href="#作用" aria-hidden="true" class="header-anchor">#</a> 作用</h3> <ul><li>限制资源获取</li> <li>报告资源获取越权</li></ul> <h3 id="限制方式"><a href="#限制方式" aria-hidden="true" class="header-anchor">#</a> 限制方式</h3> <p>default-src
全局限制</p> <p>指定资源类型
<img src="https://s2.ax1x.com/2019/01/01/F4hGq0.md.png" alt="F4hGq0.md.png"></p> <h3 id="限制只能外链"><a href="#限制只能外链" aria-hidden="true" class="header-anchor">#</a> 限制只能外链</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>'Content-Security-Policy': 'default-src http: https:'
1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="限制只能加载本站点脚本"><a href="#限制只能加载本站点脚本" aria-hidden="true" class="header-anchor">#</a> 限制只能加载本站点脚本</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>'Content-Security-Policy': 'default-src \'self\''
1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="限制-form-为本站"><a href="#限制-form-为本站" aria-hidden="true" class="header-anchor">#</a> 限制 form 为本站</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>'Content-Security-Policy': 'default-src \'self\'; form-action \'self\''
1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="只限制-script"><a href="#只限制-script" aria-hidden="true" class="header-anchor">#</a> 只限制 script</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>'Content-Security-Policy': 'script-src \'self\''
1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="上报路径"><a href="#上报路径" aria-hidden="true" class="header-anchor">#</a> 上报路径</h3> <p>如果触发 CSP 则请求 上报接口</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>'Content-Security-Policy': 'script-src \'self\'; report-uri /repoert'
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="设置是上报-但是给他加载资源"><a href="#设置是上报-但是给他加载资源" aria-hidden="true" class="header-anchor">#</a> 设置是上报, 但是给他加载资源:</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>'Content-Security-Policy-Report-Only': 'script-src \'self\'; report-uri /repoert'
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="html-中设置-meta-和服务端设置-header-都行"><a href="#html-中设置-meta-和服务端设置-header-都行" aria-hidden="true" class="header-anchor">#</a> html 中设置 meta 和服务端设置 header 都行</h3> <p>report-uri 需要在 header 才能设置.</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>UTF-8 <span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span>
    <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Content-Security-Policy<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>script-src 'self'; form-action 'self'<span class="token punctuation">&quot;</span></span>
  <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></div> <span id="footerPost" data-v-aa2eb952></span></div> <div id="post-toc" class="post-toc el-col el-col-6" data-v-aa2eb952><h4 class="catalog-title" data-v-aa2eb952>TOC</h4> <div class="catalog-body" data-v-aa2eb952><ul id="catalog-list" class="catalog-list" data-v-aa2eb952></ul></div></div></div> <div class="post-nav el-row is-justify-space-around el-row--flex" data-v-aa2eb952><div class="post-prev el-col el-col-7" data-v-aa2eb952><div data-v-aa2eb952><a href="/posts/Nginx%E5%92%8CHTTP.html" data-v-aa2eb952><i class="el-icon-arrow-left" data-v-aa2eb952></i> Prev
        </a> <p class="nav-title" data-v-aa2eb952>Nginx和HTTP</p></div></div> <div class="post-next el-col el-col-7 el-col-lg-pull-5" data-v-aa2eb952><div data-v-aa2eb952><a href="/posts/%E4%BB%8E%E7%94%A8%E9%80%94%E5%87%BA%E5%8F%91%E6%80%BB%E7%BB%93flex%E5%B8%83%E5%B1%80.html" data-v-aa2eb952>
          Next
          <i class="el-icon-arrow-right" data-v-aa2eb952></i></a> <p class="nav-title" data-v-aa2eb952>从用途出发总结flex布局</p></div></div></div> <div class="el-row is-justify-center el-row--flex" data-v-aa2eb952><div class="el-col el-col-23" data-v-aa2eb952></div></div> <span data-v-1ba756dd data-v-aa2eb952><button type="button" class="el-button toc-btn el-button--primary is-circle" data-v-1ba756dd><!----><!----><span><i class="iconfont icon-service-directory" data-v-1ba756dd></i></span></button> <button type="button" class="el-button gotop-btn el-button--primary is-circle" data-v-1ba756dd><!----><!----><span><i class="el-icon-arrow-up" data-v-1ba756dd></i></span></button></span></div></main></section> <button type="button" class="el-button gotop-btn el-button--primary is-circle" style="display:none;" data-v-db63bc4e data-v-3431ceb9><!----><!----><span><i class="el-icon-arrow-up" data-v-db63bc4e></i></span></button></section> <footer class="el-footer container-footer" style="height:60px;" data-v-6660fccd data-v-3431ceb9><div class="footer-warp el-row is-justify-center is-align-center el-row--flex footerMargin" data-v-6660fccd><div class="footer-top el-col el-col-24" data-v-6660fccd><p class="ellipsis" data-v-6660fccd><span data-v-6660fccd>
          博客内容遵循
          <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" data-v-6660fccd>知识共享 署名 - 非商业性 - 相同方式共享 4.0 国际协议</a></span></p></div> <div class="footer-bottom el-col el-col-24" data-v-6660fccd><p class="ellipsis" data-v-6660fccd><span data-v-6660fccd><span data-v-6660fccd>
            zhhlwd的个人博客 © 2018-08 ~ 2019-06
          </span></span> <span data-v-6660fccd>
          Power by
          <a href="https://vuepress.vuejs.org/zh/" target="_blank" data-v-6660fccd>VuePress</a> Theme
          <a href="https://github.com/zhhlwd/vuepress-theme-indigo-material" target="_blank" data-v-6660fccd>indigo material</a></span></p></div></div></footer> <div class="overlay" data-v-3431ceb9></div></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.39e00e98.js" defer></script><script src="/assets/js/1.c0224360.js" defer></script><script src="/assets/js/15.f0ca96b2.js" defer></script><script src="/assets/js/5.b07737de.js" defer></script><script src="/assets/js/7.9893d61a.js" defer></script><script src="/assets/js/10.9c509957.js" defer></script><script src="/assets/js/6.57699fa9.js" defer></script><script src="/assets/js/26.16680b9b.js" defer></script><script src="/assets/js/14.0e97f0ce.js" defer></script><script src="/assets/js/16.9fb85302.js" defer></script>
  </body>
</html>
